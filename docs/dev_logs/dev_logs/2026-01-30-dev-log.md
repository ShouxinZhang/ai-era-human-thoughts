# 开发日志 - 2026-01-30

## 概要
增强本地开发启动脚本对端口占用的识别与清理能力，降低“启动失败/端口冲突”导致的开发中断概率；同时新增年龄/职业/城市的可选字段，用于更精细的用户画像与内容分类展示。

## 业务目的
- 提升开发可用性：减少端口冲突引发的启动失败，保障日常迭代效率。
- 降低排障成本：脚本自动化处理端口清理，减少人工查找与干预。
- 提升洞察质量：在不强制填写的前提下，补充年龄/职业/城市信息，便于后续统计与分层分析。

## 变更清单（涉及文件）
- apps/web/dev.sh
  - 端口检测改为仅识别监听态进程，提升准确性。
  - `ss` 解析更稳健，避免因格式差异导致取不到 PID。
  - 多工具兜底（lsof → ss → fuser），避免单一工具返回空导致漏检。
  - 若占用为本项目 next dev 则重启，否则切换到新端口。

- apps/web/src/app/page.tsx
  - 在首页标题下方新增项目愿景描述文字，强化核心业务理念。

- docs/architecture/repository-structure.md
  - 补充 `dev.sh` 的职责说明（端口清理 + 启动准备）。
  - 数据模型字段补充 Age / Occupation / City。

- apps/web/src/app/api/entries/route.ts
  - API 读写新增年龄、职业、城市字段，空值不影响提交。

- apps/web/src/components/SubmitEntry.tsx
  - 表单新增年龄/职业/城市输入（自由填写）。

- apps/web/src/components/EntryList.tsx
  - 列表第二行展示年龄/职业/城市，未填写则不显示。

- apps/web/scripts/local-init.mjs
  - 本地数据库表结构新增年龄/职业/城市字段并提供迁移。
  - mock 数据调整为 3 条。

- apps/web/scripts/add-mock-data.mjs
  - 新增“追加 mock 数据”脚本，避免覆盖既有数据，并确保新增 3 条。

- apps/web/package.json
  - 新增脚本：`local:mock`。

- apps/web/scripts/sync-to-supabase.mjs
  - 同步到 Supabase 时包含年龄/职业/城市字段。

- core/schema/001_initial_schema.sql
  - Supabase 主表结构新增年龄/职业/城市字段。
  - mock 数据调整为 3 条。

## 验证
- 执行 dev.sh 启动流程，确认能正确清理端口并启动开发服务器。
- 提交新记录并验证列表第二行在填写时展示、未填写时隐藏。

## 快照（回滚指引）
- 若需回退本次改动：
  - apps/web/dev.sh
  - docs/architecture/repository-structure.md
  - apps/web/src/app/api/entries/route.ts
  - apps/web/src/components/SubmitEntry.tsx
  - apps/web/src/components/EntryList.tsx
  - apps/web/scripts/local-init.mjs
  - apps/web/scripts/sync-to-supabase.mjs
  - core/schema/001_initial_schema.sql
